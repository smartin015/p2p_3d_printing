<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/png" href="/CPQ.png">
	<title>PeerPrint Status</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
	<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
		<a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">PeerPrint</a>

		<button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
	</header>

	<div class="container-fluid">
		<div class="row">
			<nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
				<div class="position-sticky pt-3 sidebar-sticky">
					<ul class="nav flex-column nav-pills me-3" id="myTab" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="server-tab" data-bs-toggle="tab" data-bs-target="#server" type="button" role="tab" aria-controls="server" aria-selected="false">Server</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="storage-tab" data-bs-toggle="tab" data-bs-target="#storage" type="button" role="tab" aria-controls="storage" aria-selected="false">Storage</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab" aria-controls="events" aria-selected="false">Events</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button" role="tab" aria-controls="timeline" aria-selected="false">Timeline</button>
						</li>
					</ul>
				</div>
			</nav>
			<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 min-vh-90">    
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade" id="server" role="tabpanel" aria-labelledby="server-tab">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Server</h1>
          </div>
          <pre data-bind="text: JSON.stringify(serverSummary(), null, 2)">
          </pre>
        </div>

        <div class="tab-pane fade" id="storage" role="tabpanel" aria-labelledby="storage-tab">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Storage</h1>
          </div>
          <pre data-bind="text: JSON.stringify(storageSummary(), null, 2)">
          </pre>
        </div>

        <div class="tab-pane fade" id="events" role="tabpanel" aria-labelledby="events-tab">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Events</h1>
          </div>
          <div data-bind="foreach: events">
            <div data-bind="text: JSON.stringify($data)">
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="timeline" role="tabpanel" aria-labelledby="timeline-tab">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Timeline</h1>
          </div>

					<div class="my-4 w-100" id="peerTimeline" width="900" height="380"></div>
          <table class="table">
            <thead>
              <tr>
                <th>Peer ID</th>
                <th>First Seen</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: peerLogs">
              <tr>
                <td data-bind="text: $data.Name"></td>
                <td data-bind="text: $data.Start"></td>
                <td data-bind="text: $data.End"></td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
			</main>

      <footer class="footer mt-auto bg-light">
        <span class="container text-muted">
          Refreshed: <span data-bind="text: refreshTS().toISOString()"></span>s
        </div>
      </footer>

		</div>
	</div>

	<script type-='text/javascript' src='https://code.jquery.com/jquery-3.6.3.min.js'></script>
	<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js'></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
  <script src="https://cdn.plot.ly/plotly-2.18.0.min.js"></script>
	<script src="viewmodel.js"></script>
	<script>
    ko.applyBindings(new AppViewModel());
    $(document).ready(() => {
      var hash = window.location.hash || "#server-tab";
      const someTabTriggerEl = document.querySelector(hash);
      const tab = new bootstrap.Tab(someTabTriggerEl);
      tab.show();
      $("#myTab button").on("shown.bs.tab", function(e) {
          var id = $(e.target).attr("id");
          window.location.hash = id;
      });
    });
  </script>
</body>
</html>
