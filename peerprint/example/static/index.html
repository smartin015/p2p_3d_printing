<html>
  <head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"/>
  </head>
  <body>
    <button data-bind="click: mkRecord">Create a record</button>
    <button data-bind="click: setStatus">Update printer status</button>

    <div data-bind="foreach: peers">
      <div data-bind="text: JSON.stringify($data)"></div>
    </div>
    <hr/>
    <div data-bind="foreach: records">
      <div class="pt-3">
        <div data-bind="text: JSON.stringify($data)"></div>
        <button data-bind="click: $root.delete">Delete</button>
      </div>
    </div>

    <script type-='text/javascript' src='https://code.jquery.com/jquery-3.6.3.min.js'></script>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-2.18.0.min.js"></script>
    <script>
      function AppViewModel() {
        var self = this;
        self.records = ko.observableArray([]);
        self.peers = ko.observableArray([]);
        self.refresh = function() {
          $.get("/records", (data) => {
            self.records(data);
          });
          $.get("/peers", (data) => {
            self.peers(data);
          });
        };
        self.refresh();
        self.delete = function(vm) {
          $.get("/delRecord?uuid="+vm.record.uuid, (data) => {
            console.log(data);
            self.refresh();
          });
        };
        self.mkRecord = function() {
          $.get("/genRecord", (data) => {
            console.log(data);
            self.refresh();
          });
        }
        self.setStatus = function() {
          $.get("/setStatus", (data) => {
            console.log(data);
            self.refresh();
          });
        }
      }

      $(document).ready(() => {
        ko.applyBindings(new AppViewModel());
      });
    </script>
  </body>
</html>
